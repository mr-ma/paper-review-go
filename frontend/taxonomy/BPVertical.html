<!DOCTYPE html>
<!-- http://bl.ocks.org/NPashaP/3ba0031d3d555afca4713e5264455025 -->
<meta charset="utf-8">
<header>
<title>BP Vertical</title>
<style>
.mainBars rect{
  shape-rendering: auto;
  fill-opacity: 0;
  stroke-width: 0.5px;
  stroke: rgb(0, 0, 0);
  stroke-opacity: 0;
}
.subBars{
	shape-rendering:crispEdges;
}
.edges{
	stroke:none;
	fill-opacity:0.5;
}
</style>
    <script type="text/javascript" src="d3.v4.min.js"></script>
    <script src="jquery.min.js"></script>
  	<script src="viz.min.js"></script>
</header>
<body>
<script>
const colors = ["#3366CC", "#DC3912", "#FF9900", "#109618", "#990099", "#0099C6"];
$.get('attribute', function ( attributes ) {
    $.get('conceptCorrelation', function ( correlations ) {
      var data = [];
      correlations.response.forEach ( function ( link ) {
        data.push([link.attribute1, link.attribute2, link.NumberOfPapers, link.NumberOfPapers]);
      });
      /*
      attributes.response.forEach ( function ( attr, index ) {
      	if (!!attr.text && index < 20) data.push([attr.text, attr.text + '2', 10, 10]);
      });
      console.log(data)
	  */	
		var svg = d3.select("body").append("svg").attr("width", 1920).attr("height", 1600);
		var g = svg.append("g").attr("transform","translate(200,50)");

		var bp=viz.bP()
				.data(data)
				.min(12)
				.pad(1)
				.height(2400)
				.width(1000)
				.barSize(35)
				.fill(function(d) { return colors[Math.floor(Math.random() * colors.length)]; });
					
		g.call(bp);

		g.selectAll(".mainBars")
			.on("mouseover",mouseover)
			.on("mouseout",mouseout)

		g.selectAll(".mainBars").append("text").attr("class","label")
			.attr("x",d=>(d.part=="primary"? -30: 30))
			.attr("y",d=>+6)
			.text(d=>d.key)
			.attr("text-anchor",d=>(d.part=="primary"? "end": "start"));
	/*
		g.selectAll(".mainBars").append("text").attr("class","perc")
			.attr("x",d=>(d.part=="primary"? -100: 80))
			.attr("y",d=>+6)
			.text(function(d){ return d3.format("0.0%")(d.percent)})
			.attr("text-anchor",d=>(d.part=="primary"? "end": "start"));
	*/
		function mouseover(d){
			bp.mouseover(d);
			g.selectAll(".mainBars")
			.select(".perc")
			.text(function(d){ return d3.format("0.0%")(d.percent)})
		}
		function mouseout(d){
			bp.mouseout(d);
			g.selectAll(".mainBars")
				.select(".perc")
			.text(function(d){ return d3.format("0.0%")(d.percent)})
		}
		d3.select(self.frameElement).style("height", "800px");
	});
});
</script>
</body>
</html>