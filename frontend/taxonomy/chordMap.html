<!DOCTYPE html>
<!-- http://bl.ocks.org/NPashaP/ba4c802d5ef68f70c019a9706f77ebf1 -->
<meta charset="utf-8">
<style>
body {
  font: 10px sans-serif;
}

svg text{
  fill:grey;
  font-size:11px;
}
svg .values text{
  pointer-events:none;
  stroke-width: 0.5px;
}
.groups:hover{
  cursor:pointer;
  font-weight:bold;
}
</style>
<header>
  <title>Chord Diagram</title>
  <script type="text/javascript" src="d3.min.js"></script>
  <script src="jquery.min.js"></script>
  <script src="viz.min.js"></script>
</header>
<body>
<script>

  function sort(a,b){ return a < b ? -1 : (a == b ? 0 : 1); }

  $.get('attribute', function ( attributes ) {
    $.get('conceptCorrelation', function ( correlations ) {
      var data = [];
      correlations.response.forEach ( function ( link ) {
        data.push([link.attribute2, link.attribute1, link.NumberOfPapers]);
      });

      var width=1200, height=1100;

    var maxValue = 0;
    var minValue = 100;

      var svg = d3.select("body").append("svg").attr("height",height).attr("width",width);

      var defs = svg.append("defs");

      var coloursYGB = ["#FFFFDD","#AAF191","#80D385","#61B385","#3E9583","#217681","#285285","#1F2D86","#000086"];
    var colourRangeYGB = d3.range(0, 1, 1.0 / (coloursYGB.length - 1));
    colourRangeYGB.push(1);
           
    //Create color gradient
    var colorScaleYGB = d3.scale.linear()
      .domain(colourRangeYGB)
      .range(coloursYGB)
      .interpolate(d3.interpolateHcl);

    //Needed to map the values of the dataset to the color scale
    var colorInterpolateYGB = d3.scale.linear()
      .domain([minValue, maxValue])
      .range([0,1]);

    ///////////////////////////////////////////////////////////////////////////
    ///////////////////// Create the YGB color gradient ///////////////////////
    ///////////////////////////////////////////////////////////////////////////

    //Calculate the gradient  
    defs.append("linearGradient")
      .attr("id", "gradient-ygb-colors")
      .attr("x1", "0%").attr("y1", "0%")
      .attr("x2", "100%").attr("y2", "0%")
      .selectAll("stop") 
      .data(coloursYGB)                  
      .enter().append("stop") 
      .attr("offset", function(d,i) { return i/(coloursYGB.length-1); })   
      .attr("stop-color", function(d) { return d; });

    ///////////////////////////////////////////////////////////////////////////
    //////////// Get continuous color scale for the Rainbow ///////////////////
    ///////////////////////////////////////////////////////////////////////////

    var coloursRainbow = ["#2c7bb6", "#00a6ca","#00ccbc","#90eb9d","#ffff8c","#f9d057","#f29e2e","#e76818","#d7191c"];
    var colourRangeRainbow = d3.range(0, 1, 1.0 / (coloursRainbow.length - 1));
    colourRangeRainbow.push(1);
           
    //Create color gradient
    var colorScaleRainbow = d3.scale.linear()
      .domain(colourRangeRainbow)
      .range(coloursRainbow)
      .interpolate(d3.interpolateHcl);

    //Needed to map the values of the dataset to the color scale
    var colorInterpolateRainbow = d3.scale.linear()
      .domain([minValue, maxValue])
      .range([0,1]);

    ///////////////////////////////////////////////////////////////////////////
    //////////////////// Create the Rainbow color gradient ////////////////////
    ///////////////////////////////////////////////////////////////////////////

    //Calculate the gradient  
    defs.append("linearGradient")
      .attr("id", "gradient-rainbow-colors")
      .attr("x1", "0%").attr("y1", "0%")
      .attr("x2", "100%").attr("y2", "0%")
      .selectAll("stop") 
      .data(coloursRainbow)                  
      .enter().append("stop") 
      .attr("offset", function(d,i) { return i/(coloursRainbow.length-1); })   
      .attr("stop-color", function(d) { return d; });

      var ch = viz.ch().data(data)
            .padding(.01)
            .sort(sort)
          .innerRadius(430)
          .outerRadius(450)
          .duration(1000)
          .chordOpacity(0.3)
          .labelPadding(.03)
            .fill(function(d){ return colorScaleRainbow(colorInterpolateRainbow(Math.random() * 100 + 100));});

      svg.append("g").attr("transform", "translate(600,550)").call(ch);

      // adjust height of frame in bl.ocks.org
      d3.select(self.frameElement).style("height", height+"px").style("width", width+"px");
    });
  });
</script>